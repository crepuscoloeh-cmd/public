<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geminiæ´»åŠ¨è®°å½•åˆ†ç»„å·¥å…· - å…è´¹åœ¨çº¿ç‰ˆ | æŒ‰æ—¶é—´åˆ†ç»„å¯¼å‡ºå¯¹è¯è®°å½•</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="å…è´¹åœ¨çº¿å·¥å…·ï¼Œå¸®ä½ å°†Google Geminiæ´»åŠ¨è®°å½•æŒ‰æ—¶é—´æ™ºèƒ½åˆ†ç»„å¹¶å¯¼å‡ºä¸ºTXTæ–‡ä»¶ã€‚æ”¯æŒè‡ªå®šä¹‰æ—¶é—´é—´éš”ï¼Œè‡ªåŠ¨æ¸…ç†æ¨¡æ¿æ–‡å­—ï¼Œä¸œå…«åŒºæ—¶é—´æ ¡å‡†ã€‚">
  <meta name="keywords" content="Gemini,Google,æ´»åŠ¨è®°å½•,å¯¹è¯è®°å½•,åˆ†ç»„å·¥å…·,å¯¼å‡º,TXT,åœ¨çº¿å·¥å…·,å…è´¹">
  <meta name="author" content="Gemini Parser Tool">
  <meta name="robots" content="index, follow">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Geminiæ´»åŠ¨è®°å½•åˆ†ç»„å·¥å…· - å…è´¹åœ¨çº¿ç‰ˆ">
  <meta property="og:description" content="å°†Google Geminiå¯¹è¯è®°å½•æŒ‰æ—¶é—´æ™ºèƒ½åˆ†ç»„ï¼Œä¸€é”®å¯¼å‡ºTXTæ–‡ä»¶ã€‚å®Œå…¨æœ¬åœ°å¤„ç†ï¼Œä¿æŠ¤éšç§å®‰å…¨ã€‚">
  <meta property="og:image" content="https://via.placeholder.com/1200x630/4285f4/ffffff?text=Gemini+Parser">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“</text></svg>">
  
  <style>
    :root {
      --primary: #4285f4;
      --secondary: #34a853;
      --accent: #667eea;
      --warning: #ffc107;
      --success: #28a745;
      --danger: #dc3545;
      --text-primary: #212529;
      --text-secondary: #6c757d;
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --border: #dee2e6;
      --shadow: 0 4px 15px rgba(0,0,0,0.1);
      --radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, system-ui, sans-serif;
      background: linear-gradient(135deg, var(--accent) 0%, #764ba2 100%);
      min-height: 100vh; 
      padding: 20px;
      line-height: 1.6;
    }
    
    .container { 
      max-width: 1100px; 
      margin: 0 auto; 
      background: var(--bg-primary); 
      border-radius: 20px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.15); 
      overflow: hidden;
    }
    
    .header { 
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%); 
      color: white; 
      padding: 48px 40px; 
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: shimmer 4s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(0deg); }
      50% { transform: translateX(0%) translateY(0%) rotate(180deg); }
    }
    
    .header h1 { 
      font-size: clamp(2.2em, 5vw, 3.5em);
      font-weight: 800; 
      margin-bottom: 16px;
      position: relative;
      z-index: 1;
    }
    
    .header p {
      font-size: clamp(1em, 3vw, 1.3em);
      opacity: 0.95;
      position: relative;
      z-index: 1;
      font-weight: 400;
    }
    
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 32px;
      position: relative;
      z-index: 1;
    }
    
    .feature-item {
      background: rgba(255,255,255,0.15);
      padding: 20px;
      border-radius: var(--radius);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      transition: var(--transition);
    }
    
    .feature-item:hover {
      transform: translateY(-2px);
      background: rgba(255,255,255,0.25);
    }
    
    .feature-item h3 {
      font-size: 1.2em;
      margin-bottom: 8px;
      font-weight: 700;
    }
    
    .upload-section { 
      padding: 40px; 
      border-bottom: 1px solid var(--border);
      background: linear-gradient(to bottom, #fafbff 0%, var(--bg-secondary) 100%);
    }
    
    .warning { 
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); 
      color: #856404; 
      padding: 24px; 
      border-radius: var(--radius); 
      border-left: 5px solid var(--warning);
      box-shadow: var(--shadow);
      margin-bottom: 32px;
      font-weight: 500;
      line-height: 1.7;
    }
    
    .warning strong { font-weight: 700; }
    .warning a { color: #856404; text-decoration: underline; }
    .warning a:hover { text-decoration: none; }
    
    .upload-area { 
      border: 3px dashed var(--primary); 
      border-radius: 20px; 
      padding: 60px 20px; 
      cursor: pointer;
      transition: var(--transition); 
      background: linear-gradient(135deg, #fafbff 0%, #f0f8ff 100%); 
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .upload-area::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(66, 133, 244, 0.1), transparent);
      transition: left 0.6s;
    }
    
    .upload-area:hover::before { left: 100%; }
    
    .upload-area:hover, .upload-area.dragover { 
      border-color: var(--secondary); 
      background: linear-gradient(135deg, #f0f8f0 0%, #e8f5e8 100%); 
      transform: translateY(-3px) scale(1.01);
      box-shadow: 0 12px 35px rgba(52, 168, 83, 0.25);
    }
    
    .upload-icon { 
      font-size: 64px; 
      margin-bottom: 24px;
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }
    
    .upload-area h3 {
      font-size: 1.6em;
      margin-bottom: 12px;
      font-weight: 700;
    }
    
    .upload-subtitle {
      color: var(--text-secondary);
      margin-bottom: 20px;
    }
    
    .format-badges {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .format-badge {
      background: var(--primary);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
    }
    
    #fileInput { display: none; }
    
    .controls { 
      padding: 40px; 
      background: linear-gradient(to right, var(--bg-secondary) 0%, #e9ecef 100%);
      border-bottom: 1px solid var(--border);
    }
    
    .control-group { 
      display: flex; 
      gap: 24px; 
      align-items: center; 
      flex-wrap: wrap; 
      margin: 20px 0;
    }
    
    .control-group label { 
      font-weight: 700; 
      min-width: 140px; 
      font-size: 16px;
    }
    
    select, input, button { 
      padding: 16px 24px; 
      border: 2px solid var(--border); 
      border-radius: var(--radius); 
      font-size: 16px;
      transition: var(--transition);
      font-family: inherit;
      font-weight: 500;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(66, 133, 244, 0.15);
    }
    
    .btn-primary { 
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); 
      color: white; 
      border: none; 
      cursor: pointer; 
      font-weight: 700;
      font-size: 18px;
      padding: 18px 36px;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(66, 133, 244, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .btn-primary:hover:not(:disabled)::before { left: 100%; }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(66, 133, 244, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    
    .progress-section { 
      padding: 32px 40px; 
      display: none; 
      background: var(--bg-secondary);
    }
    
    .progress-bar { 
      height: 14px; 
      background: #e9ecef; 
      border-radius: 10px; 
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .progress-fill { 
      height: 100%; 
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent)); 
      width: 0%; 
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      border-radius: 10px;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.4) 50%, transparent 100%);
      animation: progress-shine 2s infinite;
    }
    
    @keyframes progress-shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .progress-text { 
      margin-top: 16px; 
      text-align: center; 
      font-size: 15px;
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    .results { 
      padding: 40px; 
      display: none;
      background: linear-gradient(to bottom, var(--bg-primary) 0%, #fafbff 100%);
    }
    
    .stats { 
      background: linear-gradient(135deg, var(--bg-secondary) 0%, #e9ecef 100%); 
      padding: 32px; 
      border-radius: 18px; 
      margin-bottom: 32px;
      box-shadow: var(--shadow);
    }
    
    .stats-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 24px;
    }
    
    .stat-item { 
      text-align: center;
      padding: 24px;
      background: rgba(255,255,255,0.9);
      border-radius: var(--radius);
      transition: var(--transition);
    }
    
    .stat-item:hover { transform: translateY(-4px); }
    
    .stat-number { 
      font-size: 3em; 
      font-weight: 900; 
      color: var(--primary);
      margin-bottom: 8px;
      display: block;
    }
    
    .stat-label {
      color: var(--text-secondary);
      font-weight: 700;
      font-size: 15px;
    }
    
    .file-list { display: grid; gap: 20px; }
    
    .file-item { 
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%); 
      border: 2px solid var(--border); 
      border-radius: 18px; 
      padding: 24px; 
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      transition: var(--transition);
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }
    
    .file-item:hover { 
      border-color: var(--primary); 
      box-shadow: var(--shadow);
      transform: translateY(-2px);
    }
    
    .file-info { display: flex; align-items: center; gap: 20px; flex: 1; }
    .file-icon { font-size: 40px; }
    
    .file-details h3 {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    
    .file-meta {
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
    }
    
    .download-btn { 
      background: linear-gradient(135deg, var(--primary) 0%, #1a73e8 100%); 
      color: white; 
      border: none; 
      padding: 14px 28px; 
      border-radius: var(--radius); 
      cursor: pointer; 
      font-weight: 700;
      font-size: 16px;
      transition: var(--transition);
      box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3);
    }
    
    .download-btn:hover {
      background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(66, 133, 244, 0.4);
    }
    
    .debug { 
      padding: 24px 40px; 
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); 
      font-family: 'Courier New', monospace; 
      color: #ecf0f1; 
      font-size: 13px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .debug::-webkit-scrollbar { width: 8px; }
    .debug::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
    .debug::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
    
    .footer {
      padding: 32px 40px;
      background: var(--text-primary);
      color: white;
      text-align: center;
    }
    
    .footer h3 { margin-bottom: 16px; font-weight: 700; }
    .footer p { opacity: 0.8; margin-bottom: 8px; }
    
    .footer-links {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 24px;
      flex-wrap: wrap;
    }
    
    .footer-link {
      color: var(--secondary);
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition);
    }
    
    .footer-link:hover { color: white; transform: translateY(-1px); }
    
    .message {
      padding: 16px 20px;
      border-radius: var(--radius);
      margin-bottom: 20px;
      font-weight: 600;
    }
    
    .message.success {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      color: var(--success);
      border-left: 5px solid var(--success);
    }
    
    .message.error {
      background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
      color: var(--danger);
      border-left: 5px solid var(--danger);
    }
    
    @media (max-width: 768px) { 
      body { padding: 10px; }
      .container { border-radius: 16px; }
      .header { padding: 32px 20px; }
      .upload-section, .controls, .results { padding: 24px 20px; }
      .control-group { flex-direction: column; align-items: flex-start; gap: 16px; } 
      .control-group label { min-width: auto; } 
      .file-item { flex-direction: column; gap: 20px; text-align: center; }
      .upload-area { padding: 40px 16px; }
      .features { grid-template-columns: 1fr; }
      .btn-primary { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>ğŸ“ Geminiæ´»åŠ¨è®°å½•åˆ†ç»„å·¥å…·</h1>
      <p>æ™ºèƒ½è§£æ Â· æŒ‰æ—¶é—´åˆ†ç»„ Â· ä¸€é”®å¯¼å‡º Â· å®Œå…¨å…è´¹</p>
      
      <div class="features">
        <div class="feature-item">
          <h3>ğŸ”’ éšç§å®‰å…¨</h3>
          <p>æœ¬åœ°å¤„ç†ï¼Œæ•°æ®ä¸ä¸Šä¼ </p>
        </div>
        <div class="feature-item">
          <h3>âš¡ æ™ºèƒ½è§£æ</h3>
          <p>è‡ªåŠ¨è¯†åˆ«å¯¹è¯å†…å®¹</p>
        </div>
        <div class="feature-item">
          <h3>ğŸ• æ—¶é—´æ ¡å‡†</h3>
          <p>ä¸œå…«åŒºæ—¶é—´è‡ªåŠ¨è½¬æ¢</p>
        </div>
        <div class="feature-item">
          <h3>ğŸ“ æ‰¹é‡å¯¼å‡º</h3>
          <p>æŒ‰æ—¶é—´æ®µç”ŸæˆTXTæ–‡ä»¶</p>
        </div>
      </div>
    </header>

    <main>
      <section class="upload-section">
        <div class="warning">
          <strong>ğŸ“‹ è¯¦ç»†ä½¿ç”¨è¯´æ˜ï¼š</strong>
          <br><strong>ç¬¬ä¸€æ­¥ï¼š</strong>è®¿é—® <a href="https://myactivity.google.com" target="_blank">Googleæˆ‘çš„æ´»åŠ¨</a>
          <br><strong>ç¬¬äºŒæ­¥ï¼š</strong>ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ éšç§ä¿¡æ¯ä¸­å¿ƒ
          <br><strong>ç¬¬ä¸‰æ­¥ï¼š</strong>é€‰æ‹©ã€Œè¯·æ±‚åˆ é™¤å†…å®¹å’Œå¯¼å‡ºæ•°æ®ã€
          <br><strong>ç¬¬å››æ­¥ï¼š</strong>ç‚¹å‡»ã€Œå¯¼å‡ºã€ï¼Œäº§å“é€‰æ‹©ã€Œæˆ‘çš„æ´»åŠ¨ã€
          <br><strong>ç¬¬äº”æ­¥ï¼š</strong>ç­‰å¾…å¯¼å‡ºå®Œæˆï¼Œä¸‹è½½å‹ç¼©åŒ…
          <br><strong>ç¬¬å…­æ­¥ï¼š</strong>è§£å‹åæ‰¾åˆ°ã€ŒGemini Appsã€æ–‡ä»¶å¤¹
          <br><strong>ç¬¬ä¸ƒæ­¥ï¼š</strong>é€‰æ‹©ã€Œæˆ‘çš„æ´»åŠ¨è®°å½•.htmlã€æ–‡ä»¶æ‹–å…¥ä¸‹æ–¹åŒºåŸŸ
          <br><strong>ç¬¬å…«æ­¥ï¼š</strong>é€‰æ‹©æ—¶é—´åˆ†ç»„é—´éš”ï¼Œç‚¹å‡»å¼€å§‹å¤„ç†
        </div>
        
        <div class="upload-area" id="dropZone">
          <div class="upload-icon">ğŸ“</div>
          <h3>é€‰æ‹©æˆ–æ‹–æ”¾ Gemini å¯¼å‡ºçš„ HTML æ–‡ä»¶</h3>
          <p class="upload-subtitle">æ”¯æŒçš„æ ¼å¼å’Œç¼–ç </p>
          <div class="format-badges">
            <span class="format-badge">HTML</span>
            <span class="format-badge">UTF-8</span>
            <span class="format-badge">UTF-16</span>
          </div>
        </div>
        <input type="file" id="fileInput" accept=".html,.htm">
      </section>

      <section class="controls">
        <div class="control-group">
          <label for="timeInterval">ğŸ“… åˆ†ç»„é—´éš”:</label>
          <select id="timeInterval">
            <option value="1">1å¤©</option>
            <option value="3">3å¤©</option>
            <option value="7" selected>1å‘¨</option>
            <option value="14">2å‘¨</option>
            <option value="30">1ä¸ªæœˆ</option>
            <option value="90">3ä¸ªæœˆ</option>
            <option value="custom">è‡ªå®šä¹‰å¤©æ•°</option>
          </select>
          <input type="number" id="customDays" placeholder="è¾“å…¥å¤©æ•°" min="1" max="365" style="display:none; width:140px;">
        </div>
        <div class="control-group">
          <button class="btn-primary" id="processBtn">ğŸš€ å¼€å§‹å¤„ç†</button>
        </div>
      </section>

      <section class="progress-section" id="progressSection">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">å‡†å¤‡å¤„ç†æ–‡ä»¶...</div>
      </section>

      <section id="results" class="results">
        <div class="stats">
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-number" id="totalConversations">0</span>
              <div class="stat-label">ğŸ’¬ æ€»å¯¹è¯æ•°</div>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="totalFiles">0</span>
              <div class="stat-label">ğŸ“„ ç”Ÿæˆæ–‡ä»¶æ•°</div>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="dateRange">-</span>
              <div class="stat-label">ğŸ• æ—¶é—´èŒƒå›´</div>
            </div>
          </div>
        </div>
        <div id="fileList" class="file-list"></div>
      </section>
    </main>

    <div class="debug">
      <div><strong>ğŸ” å¤„ç†æ—¥å¿—ï¼š</strong></div>
      <pre id="debugLog"></pre>
    </div>

    <footer class="footer">
      <h3>å…³äºæœ¬å·¥å…·</h3>
      <p>å®Œå…¨å…è´¹çš„åœ¨çº¿å·¥å…·ï¼Œå¸®åŠ©æ‚¨æ•´ç†å’Œå¯¼å‡ºGoogle Geminiå¯¹è¯è®°å½•</p>
      <p>æ‰€æœ‰æ•°æ®åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°å¤„ç†ï¼Œç»ä¸ä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨</p>
      <div class="footer-links">
        <a href="#" class="footer-link">ä½¿ç”¨è¯´æ˜</a>
        <a href="#" class="footer-link">éšç§æ”¿ç­–</a>
        <a href="#" class="footer-link">æ„è§åé¦ˆ</a>
        <a href="https://github.com" class="footer-link" target="_blank">GitHub</a>
      </div>
    </footer>
  </div>

  <script>
    // Debug logging
    const debugLog = document.getElementById('debugLog');
    const log = (...args) => {
      const timestamp = new Date().toLocaleTimeString('zh-CN');
      debugLog.textContent += `[${timestamp}] ${args.join(' ')}\n`;
      debugLog.scrollTop = debugLog.scrollHeight;
    };

    // DOM elements
    const $ = sel => document.querySelector(sel);
    const dropZone = $('#dropZone');
    const fileInput = $('#fileInput');
    const processBtn = $('#processBtn');
    const progressSection = $('#progressSection');
    const resultsSection = $('#results');

    // Global state
    let processedFiles = [];

    // Drag and drop
    ['dragenter', 'dragover'].forEach(eventName => {
      dropZone.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.classList.add('dragover');
      });
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.classList.remove('dragover');
      });
    });

    dropZone.addEventListener('drop', (e) => {
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        log(`æ–‡ä»¶å·²æ‹–å…¥: ${files[0].name} (${(files[0].size / 1024).toFixed(1)}KB)`);
        processBtn.textContent = 'ğŸš€ å¼€å§‹å¤„ç†';
      }
    });

    dropZone.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        const file = e.target.files[0];
        log(`æ–‡ä»¶å·²é€‰æ‹©: ${file.name} (${(file.size / 1024).toFixed(1)}KB)`);
        processBtn.textContent = 'ğŸš€ å¼€å§‹å¤„ç†';
      }
    });

    // Time interval selection
    $('#timeInterval').addEventListener('change', function() {
      const customInput = $('#customDays');
      if (this.value === 'custom') {
        customInput.style.display = 'inline-block';
        customInput.focus();
      } else {
        customInput.style.display = 'none';
      }
    });

    // Progress update
    function updateProgress(percentage, message) {
      $('#progressFill').style.width = `${percentage}%`;
      $('#progressText').textContent = message;
    }

    // File reading with encoding detection
    function readFileAsync(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const buffer = reader.result;
            let text = new TextDecoder('utf-8', {fatal: false}).decode(buffer);
            
            if (text.includes('\u0000')) {
              text = new TextDecoder('utf-16le', {fatal: false}).decode(buffer);
            }
            
            resolve(text);
          } catch (error) {
            reject(new Error('æ–‡ä»¶ç¼–ç ä¸æ”¯æŒæˆ–æ–‡ä»¶å·²æŸå'));
          }
        };
        reader.onerror = () => reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
        reader.readAsArrayBuffer(file);
      });
    }

    // HTML to text conversion
    function htmlToText(html) {
      let text = html;
      
      // Remove script and style tags
      text = text.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
      text = text.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi, '');
      
      // Convert line-breaking elements to newlines
      text = text.replace(/<(br|BR)\s*\/?>/g, '\n');
      text = text.replace(/<\/(p|div|li|section|article|header|footer|h[1-6])>/gi, '\n');
      text = text.replace(/<(p|div|li|section|article|header|footer|h[1-6])\b[^>]*>/gi, '\n');
      
      // Remove all remaining HTML tags
      text = text.replace(/<[^>]+>/g, '');
      
      // Decode HTML entities
      text = text.replace(/&nbsp;/g, ' ')
                 .replace(/&emsp;/g, ' ')
                 .replace(/&lt;/g, '<')
                 .replace(/&gt;/g, '>')
                 .replace(/&amp;/g, '&')
                 .replace(/&quot;/g, '"')
                 .replace(/&#39;/g, "'");
      
      // Normalize line breaks
      text = text.replace(/\r\n?/g, '\n')
                 .replace(/\n{3,}/g, '\n\n')
                 .trim();
      
      return text;
    }

    // Parse timestamp with timezone conversion
    function parseTimestamp(timestamp) {
      const raw = timestamp.trim();
      const hasAM = /ä¸Šåˆ/.test(raw);
      const hasPM = /ä¸‹åˆ/.test(raw);
      
      // Extract timezone
      let timezone = null;
      const tzMatch = raw.match(/\b(PDT|PST|UTC|GMT[+\-]?\d{0,2})\b/);
      if (tzMatch) {
        timezone = tzMatch[1];
      }
      
      // Clean timestamp string
      let cleanTime = raw.replace(/å¹´|æœˆ/g, '/').replace(/æ—¥/g, '');
      if (tzMatch) {
        cleanTime = cleanTime.replace(tzMatch[0], '').trim();
      }
      
      // Parse date and time
      const match = cleanTime.match(/(\d{4})\/(\d{1,2})\/(\d{1,2})\s+(\d{1,2}):(\d{2})(?::(\d{2}))?/);
      if (match) {
        const [, year, month, day, hour, minute, second] = match;
        let parsedHour = parseInt(hour);
        
        // Handle AM/PM
        if (hasPM && parsedHour < 12) parsedHour += 12;
        if (hasAM && parsedHour === 12) parsedHour = 0;
        
        // Calculate timezone offset
        let offsetMinutes = 0;
        if (timezone === 'PDT') offsetMinutes = -7 * 60;
        else if (timezone === 'PST') offsetMinutes = -8 * 60;
        else if (timezone === 'UTC') offsetMinutes = 0;
        else if (timezone && /^GMT[+\-]\d{1,2}$/.test(timezone)) {
          offsetMinutes = parseInt(timezone.slice(3)) * 60;
        }
        
        // Create UTC timestamp and convert to China Standard Time (UTC+8)
        const utcTime = Date.UTC(
          parseInt(year), 
          parseInt(month) - 1, 
          parseInt(day), 
          parsedHour - (offsetMinutes / 60), 
          parseInt(minute), 
          parseInt(second || '0')
        );
        
        const chinaTime = utcTime + (8 * 60 * 60 * 1000);
        return new Date(chinaTime);
      }
      
      // Fallback
      const fallback = new Date(raw);
      return isNaN(fallback.getTime()) ? new Date() : fallback;
    }

    // Main parsing function
    function parseGeminiHTML(html) {
      const conversations = [];
      const text = htmlToText(html);
      
      // Enhanced boilerplate removal patterns
      const boilerplatePatterns = [
        /(äº§å“ï¼š?\s*Gemini\s*Apps?)/gi,
        /(å•†å“ï¼š?\s*Gemini\s*Apps?)/gi,
        /ä¸ºä»€ä¹ˆæ­¤å¤„ä¼šæ˜¾ç¤ºæ­¤æ´»åŠ¨è®°å½•[ï¼Ÿ?]/gi,
        /ç”±äºä»¥ä¸‹è®¾ç½®å¤„äºå·²å¯ç”¨çŠ¶æ€[\s\S]*?Gemini\s*Apps?\s*Activity/gi,
        /æ‚¨å¯ä»¥ç‚¹å‡»æ­¤å¤„æ§åˆ¶è¿™äº›è®¾ç½®[ã€‚.]?/gi,
        /\s*Gemini\s*Apps?\s*$/gmi,
        /^\s*å•†å“ï¼š?\s*$/gmi,
        /^\s*äº§å“ï¼š?\s*$/gmi
      ];
      
      // Clean the text multiple times
      let cleanText = text;
      for (let i = 0; i < 3; i++) {
        boilerplatePatterns.forEach(pattern => {
          cleanText = cleanText.replace(pattern, '');
        });
      }
      
      // Normalize "Prompted" markers
      cleanText = cleanText.replace(/Gemini\s*Apps?\s*Prompted/gi, 'Prompted')
                          .replace(/\n\s*Prompted\s*\n?/gi, '\nPrompted\n');
      
      // Split by Prompted blocks
      const blocks = cleanText.split(/^\s*Prompted\s*$/im);
      const timestampRegex = /(\d{4}å¹´\d{1,2}æœˆ\d{1,2}æ—¥\s*(?:ä¸Šåˆ|ä¸‹åˆ)?\s*\d{1,2}:\d{2}(?::\d{2})?\s*(?:PDT|PST|UTC|GMT[+\-]?\d{0,2})?)|(\d{4}[\/-]\d{1,2}[\/-]\d{1,2}\s+\d{1,2}:\d{2}(?::\d{2})?\s*(?:PDT|PST|UTC|GMT[+\-]?\d{0,2})?)/;
      
      log(`å¼€å§‹è§£æ ${blocks.length - 1} ä¸ªå¯¹è¯å—`);
      
      for (let i = 1; i < blocks.length; i++) {
        let block = blocks[i].trim();
        if (block.length < 10) continue;
        
        // Clean boilerplate from each block
        boilerplatePatterns.forEach(pattern => {
          block = block.replace(pattern, '');
        });
        
        const timestampMatch = block.match(timestampRegex);
        if (!timestampMatch) continue;
        
        const timestampStr = timestampMatch[0];
        const timestampIndex = timestampMatch.index;
        
        // Split content at timestamp
        const userPart = block.slice(0, timestampIndex).trim();
        const geminiPart = block.slice(timestampIndex + timestampStr.length).trim();
        
        // Clean parts again
        let userMessage = userPart;
        let geminiMessage = geminiPart;
        
        boilerplatePatterns.forEach(pattern => {
          userMessage = userMessage.replace(pattern, '');
          geminiMessage = geminiMessage.replace(pattern, '');
        });
        
        userMessage = userMessage.trim();
        geminiMessage = geminiMessage.trim();
        
        if (userMessage || geminiMessage) {
          conversations.push({
            timestamp: parseTimestamp(timestampStr),
            userMessage,
            aiMessage: geminiMessage
          });
        }
      }
      
      // Deduplicate and sort
      const seen = new Set();
      const unique = [];
      
      conversations.sort((a, b) => a.timestamp - b.timestamp).forEach(conv => {
        const key = (conv.userMessage + '|' + conv.aiMessage).slice(0, 100);
        if (!seen.has(key) && (conv.userMessage || conv.aiMessage)) {
          seen.add(key);
          unique.push(conv);
        }
      });
      
      log(`è§£æå®Œæˆï¼Œæ‰¾åˆ° ${unique.length} æ¡æœ‰æ•ˆå¯¹è¯`);
      return unique;
    }

    // Group conversations by time interval
    function groupByTimeInterval(conversations, intervalDays) {
      if (conversations.length === 0) return [];
      
      const msPerDay = 24 * 60 * 60 * 1000;
      const intervalMs = intervalDays * msPerDay;
      
      const earliest = Math.min(...conversations.map(c => c.timestamp.getTime()));
      const latest = Math.max(...conversations.map(c => c.timestamp.getTime()));
      
      const startTime = new Date(earliest);
      startTime.setHours(0, 0, 0, 0);
      
      const endTime = new Date(latest);
      endTime.setHours(23, 59, 59, 999);
      
      const groups = [];
      
      for (let time = startTime.getTime(); time <= endTime.getTime(); time += intervalMs) {
        const groupEnd = time + intervalMs - 1;
        const conversationsInRange = conversations.filter(conv => {
          const convTime = conv.timestamp.getTime();
          return convTime >= time && convTime <= groupEnd;
        }).sort((a, b) => a.timestamp - b.timestamp);
        
        if (conversationsInRange.length > 0) {
          groups.push({
            startDate: new Date(time),
            endDate: new Date(groupEnd),
            conversations: conversationsInRange
          });
        }
      }
      
      return groups;
    }

    // Generate TXT files
    function generateTXTFiles(groups, intervalDays) {
      const files = [];
      const intervalNames = {
        1: 'æ—¥', 3: '3æ—¥', 7: 'å‘¨', 14: 'åŒå‘¨', 
        30: 'æœˆ', 90: 'å­£'
      };
      const intervalName = intervalNames[intervalDays] || `${intervalDays}æ—¥`;
      
      const formatDate = (date) => {
        return date.toLocaleDateString('zh-CN', { 
          timeZone: 'Asia/Shanghai' 
        }).replace(/\//g, '-');
      };
      
      const formatDateTime = (date) => {
        return date.toLocaleString('zh-CN', { 
          timeZone: 'Asia/Shanghai' 
        });
      };
      
      groups.forEach((group, index) => {
        const startDate = formatDate(group.startDate);
        const endDate = formatDate(group.endDate);
        
        let content = `Geminiå¯¹è¯è®°å½• - ç¬¬${index + 1}${intervalName}\n`;
        content += `æ—¶é—´èŒƒå›´(ä¸œå…«åŒº): ${startDate} è‡³ ${endDate}\n`;
        content += `å¯¹è¯æ•°é‡: ${group.conversations.length}\n`;
        content += `ç”Ÿæˆæ—¶é—´: ${formatDateTime(new Date())}\n`;
        content += `ç”Ÿæˆå·¥å…·: Geminiæ´»åŠ¨è®°å½•åˆ†ç»„å·¥å…· åœ¨çº¿ç‰ˆ\n`;
        content += `${'='.repeat(60)}\n\n`;
        
        group.conversations.forEach((conversation, convIndex) => {
          const timestamp = formatDateTime(conversation.timestamp);
          content += `[å¯¹è¯ ${convIndex + 1}] - ${timestamp}\n`;
          content += `${'â”€'.repeat(40)}\n`;
          
          if (conversation.userMessage) {
            content += `ğŸ‘¤ User:\n${conversation.userMessage}\n\n`;
          }
          
          if (conversation.aiMessage) {
            content += `ğŸ¤– Gemini:\n${conversation.aiMessage}\n\n`;
          }
          
          content += `${'â”€'.repeat(40)}\n\n`;
        });
        
        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const filename = `Geminiå¯¹è¯è®°å½•-ç¬¬${index + 1}${intervalName}-${startDate}.txt`;
        
        files.push({
          name: filename,
          blob,
          startDate,
          endDate,
          count: group.conversations.length,
          url: URL.createObjectURL(blob)
        });
      });
      
      return files;
    }

    // Main processing function
    async function processFile() {
      const file = fileInput.files[0];
      if (!file) {
        showMessage('è¯·å…ˆé€‰æ‹©æ–‡ä»¶', 'error');
        return;
      }
      
      // UI state updates
      processBtn.disabled = true;
      processBtn.textContent = 'â³ å¤„ç†ä¸­...';
      progressSection.style.display = 'block';
      resultsSection.style.display = 'none';
      
      log(`å¼€å§‹å¤„ç†æ–‡ä»¶: ${file.name} (${(file.size / 1024).toFixed(1)}KB)`);
      
      try {
        // Read file
        updateProgress(10, 'æ­£åœ¨è¯»å–æ–‡ä»¶...');
        const htmlContent = await readFileAsync(file);
        log(`æ–‡ä»¶è¯»å–å®Œæˆï¼Œå†…å®¹é•¿åº¦: ${htmlContent.length} å­—ç¬¦`);
        
        // Parse conversations
        updateProgress(35, 'æ­£åœ¨è§£æå¯¹è¯è®°å½•...');
        const conversations = parseGeminiHTML(htmlContent);
        
        if (conversations.length === 0) {
          throw new Error('æœªæ‰¾åˆ°æœ‰æ•ˆçš„å¯¹è¯è®°å½•ã€‚è¯·ç¡®è®¤æ–‡ä»¶æ˜¯ä»"Googleæˆ‘çš„æ´»åŠ¨ â†’ Gemini Apps"å¯¼å‡ºçš„HTMLæ–‡ä»¶ã€‚');
        }
        
        // Group by time interval
        updateProgress(60, 'æ­£åœ¨æŒ‰æ—¶é—´åˆ†ç»„...');
        let intervalDays = parseInt($('#timeInterval').value);
        
        if ($('#timeInterval').value === 'custom') {
          const customDays = parseInt($('#customDays').value);
          if (!customDays || customDays <= 0 || customDays > 365) {
            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„è‡ªå®šä¹‰å¤©æ•°(1-365)');
          }
          intervalDays = customDays;
        }
        
        const groups = groupByTimeInterval(conversations, intervalDays);
        log(`åˆ†ç»„å®Œæˆï¼Œç”Ÿæˆ ${groups.length} ä¸ªæ—¶é—´æ®µ`);
        
        // Generate files
        updateProgress(85, 'æ­£åœ¨ç”ŸæˆTXTæ–‡ä»¶...');
        processedFiles = generateTXTFiles(groups, intervalDays);
        
        updateProgress(100, 'ğŸ‰ å¤„ç†å®Œæˆ!');
        showMessage('å¤„ç†æˆåŠŸï¼æ–‡ä»¶å·²ç”Ÿæˆï¼Œå¯ä»¥ä¸‹è½½äº†ã€‚', 'success');
        displayResults();
        
      } catch (error) {
        log(`å¤„ç†å¤±è´¥: ${error.message}`);
        showMessage(`å¤„ç†å¤±è´¥: ${error.message}`, 'error');
        updateProgress(0, 'âŒ å¤„ç†å¤±è´¥');
      } finally {
        processBtn.disabled = false;
        processBtn.textContent = 'ğŸš€ å¼€å§‹å¤„ç†';
        setTimeout(() => {
          progressSection.style.display = 'none';
        }, 2000);
      }
    }

    // Display results
    function displayResults() {
      const totalConversations = processedFiles.reduce((sum, file) => sum + file.count, 0);
      
      $('#totalConversations').textContent = totalConversations;
      $('#totalFiles').textContent = processedFiles.length;
      
      if (processedFiles.length > 0) {
        const firstDate = processedFiles[0].startDate;
        const lastDate = processedFiles[processedFiles.length - 1].endDate;
        $('#dateRange').textContent = `${firstDate} - ${lastDate}`;
      }
      
      const fileList = $('#fileList');
      fileList.innerHTML = '';
      
      processedFiles.forEach(file => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        
        fileItem.innerHTML = `
          <div class="file-info">
            <div class="file-icon">ğŸ“„</div>
            <div class="file-details">
              <h3>${file.name}</h3>
              <div class="file-meta">æ—¶é—´: ${file.startDate} - ${file.endDate} | å¯¹è¯æ•°: ${file.count}</div>
            </div>
          </div>
          <button class="download-btn" onclick="downloadFile('${file.url}', '${file.name}')">
            ğŸ“¥ ä¸‹è½½TXT
          </button>
        `;
        
        fileList.appendChild(fileItem);
      });
      
      resultsSection.style.display = 'block';
      log(`ç»“æœå±•ç¤ºå®Œæˆï¼Œå…± ${processedFiles.length} ä¸ªæ–‡ä»¶å¯ä¾›ä¸‹è½½`);
    }

    // Download file
    function downloadFile(url, filename) {
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      log(`ä¸‹è½½æ–‡ä»¶: ${filename}`);
    }

    // Show message
    function showMessage(message, type = 'info') {
      // Remove existing messages
      const existingMessages = document.querySelectorAll('.message');
      existingMessages.forEach(msg => msg.remove());
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      messageDiv.textContent = message;
      
      const uploadSection = document.querySelector('.upload-section');
      uploadSection.insertBefore(messageDiv, uploadSection.firstChild);
      
      // Auto-remove after 5 seconds
      setTimeout(() => {
        if (messageDiv.parentNode) {
          messageDiv.remove();
        }
      }, 5000);
    }

    // Event listeners
    processBtn.addEventListener('click', processFile);

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      processedFiles.forEach(file => {
        URL.revokeObjectURL(file.url);
      });
    });

    // Initialize
    log('Geminiæ´»åŠ¨è®°å½•åˆ†ç»„å·¥å…· åœ¨çº¿ç‰ˆå·²åŠ è½½å®Œæˆ');
    log('å·¥å…·ç‰¹ç‚¹: éšç§å®‰å…¨(æœ¬åœ°å¤„ç†) | æ™ºèƒ½è§£æ | æ—¶é—´æ ¡å‡† | æ‰¹é‡å¯¼å‡º');
  </script>
</body>
</html>